<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Lightning Hub</title>
  <link rel="stylesheet" href="/assets/css/styles.css">
</head>
<body>
  <article>
    <h1 id="lightning-hub">Lightning Hub</h1>

<p>To act as a connector to your client apps, you will need either LNBits or Albyhub, in addition to your Lightning node backend.</p>

<p>Click to choose a Lightning Hub as your base of operations:</p>

<ul>
  <li><a href="#lnbits"><strong>LNBits</strong></a> connects to pretty much any Lightning backend</li>
  <li><a href="#albyhub"><strong>Albyhub</strong></a> connects to Phoenixd (recommended), LDK (bundled with Albyhub), and LND.</li>
</ul>

<h2 id="lnbits">LNBits</h2>
<h3 id="clone-the-repo">Clone the repo</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir -p ~/code &amp;&amp; cd ~/code
git clone https://github.com/lnbits/lnbits
cd ~/code/lnbits
</code></pre></div></div>
<h3 id="install-dependencies">Install dependencies</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt install build-essential libsecp256k1-dev pkg-config python3-dev
# install poetry
curl -sSL https://install.python-poetry.org | python3 -
</code></pre></div></div>

<p>Make sure you copy and paste the <code class="language-plaintext highlighter-rouge">export</code> command that poetry’s installer spits out so that you can execute poetry from your current shell. If you want to be able to permanently install poetry on your system, you should append this <code class="language-plaintext highlighter-rouge">export</code> command to your <code class="language-plaintext highlighter-rouge">~/.bashrc</code> file. To test whether <code class="language-plaintext highlighter-rouge">poetry</code> works, run:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>poetry --version
</code></pre></div></div>

<p>If it worked, you now have poetry and you can move on to the next step:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout main
poetry install --only main
</code></pre></div></div>
<h3 id="configure-lnbits">Configure LNBits</h3>
<p>Copy to clipboard the http-password from phoenix.conf</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker exec -it phoenixd cat /phoenix/.phoenix/phoenix.conf | grep http-password=
</code></pre></div></div>
<p>Now create and edit the .env file</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cp .env.example .env
nano .env
</code></pre></div></div>

<ul>
  <li>Change <code class="language-plaintext highlighter-rouge">HOST=127.0.0.1</code> to <code class="language-plaintext highlighter-rouge">HOST=0.0.0.0</code></li>
  <li>Change <code class="language-plaintext highlighter-rouge">LNBITS_BACKEND_WALLET_CLASS=VoidWallet</code> to <code class="language-plaintext highlighter-rouge">LNBITS_BACKEND_WALLET_CLASS=PhoenixdWallet</code></li>
  <li>find the <code class="language-plaintext highlighter-rouge"># PhoenixdWallet</code> section and change the line that says <code class="language-plaintext highlighter-rouge">PHOENIXD_API_PASSWORD=PHOENIXD_KEY</code> to <code class="language-plaintext highlighter-rouge">PHOENIXD_API_PASSWORD=&lt;paste your http-password&gt;</code></li>
  <li>Ctrl+s then Ctrl+x to save and exit</li>
</ul>

<h3 id="systemd-service">Systemd service</h3>
<p>Follow instructions to <a href="https://github.com/lnbits/lnbits/blob/main/docs/guide/installation.md#lnbits-as-a-systemd-service">install lnbits as a systemd service</a> (repeated here for your convenience):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo nano /etc/systemd/system/lnbits.service
</code></pre></div></div>
<p>Copy and paste the following into the file (ctrl+shift+v to paste in linux or cmd+v on mac) (<strong>NOTE: If you’re not using an orangepi for this tutorial, make sure to replace all occurrences of “orangepi” with your actual username below</strong>):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Systemd unit for lnbits
# /etc/systemd/system/lnbits.service

[Unit]
Description=LNbits
# you can uncomment these lines if you know what you're doing
# it will make sure that lnbits starts after lnd (replace with your own backend service)
#Wants=lnd.service
#After=lnd.service

[Service]
# replace with the absolute path of your lnbits installation
WorkingDirectory=/home/orangepi/code/lnbits
# same here. run `which poetry` if you can't find the poetry binary
ExecStart=/home/orangepi/.local/bin/poetry run lnbits
# replace with the user that you're running lnbits on
User=orangepi
Restart=always
TimeoutSec=120
RestartSec=30
Environment=PYTHONUNBUFFERED=1

[Install]
WantedBy=multi-user.target
</code></pre></div></div>
<ul>
  <li>Ctrl+s, Ctrl+x to save and exit</li>
  <li>Enable lnbits to run on system boot, and start:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo systemctl enable lnbits.service
sudo systemctl start lnbits.service
</code></pre></div>    </div>
  </li>
</ul>

<p>Check to make sure lnbits is connected to phoenixd. Check the logs and make sure you see <code class="language-plaintext highlighter-rouge">PhoenixdWallet</code>, not <code class="language-plaintext highlighter-rouge">VoidWallet</code>:</p>

<p><code class="language-plaintext highlighter-rouge">sudo journalctl -u lnbits -ef</code></p>

<p>On some systems you may need this instead:</p>

<p><code class="language-plaintext highlighter-rouge">sudo tail -f /var/log/syslog</code></p>

<p>Once lnbits is running and connected to phoenixd properly, you should enable the admin UI to be able to install the LNDHub extension:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nano .env
</code></pre></div></div>

<ul>
  <li>Change <code class="language-plaintext highlighter-rouge">LNBITS_ADMIN_UI=false</code> to <code class="language-plaintext highlighter-rouge">LNBITS_ADMIN_UI=true</code> (<strong>PAY ATTENTION TO THE NOTE AT THE TOP EXPLAINING THAT THE REST OF THE CONFIG IS IGNORED WHEN THIS SETTING IS ON</strong>)</li>
</ul>

<p>Go on to the next step to install LNDHub. Once it’s installed, you can deactivate the admin UI again.</p>

<h3 id="lndhub">LndHub</h3>

<h4 id="install-and-get-invoice-qr">Install and Get Invoice QR</h4>
<ul>
  <li>Log into the lnbits superuser portal in your browser (<code class="language-plaintext highlighter-rouge">http://&lt;orangepi LAN IP, same as SSH&gt;:5000</code>)</li>
  <li>Create a username and password, making sure to save your wallet link somewhere secure, like a password manager.</li>
  <li>Click <code class="language-plaintext highlighter-rouge">Extensions</code></li>
  <li>Click <code class="language-plaintext highlighter-rouge">All</code></li>
  <li>Search for “lndhub” in the search bar</li>
  <li>find the <code class="language-plaintext highlighter-rouge">LndHub</code> extension and click <code class="language-plaintext highlighter-rouge">Manage</code></li>
  <li>Click the dropdown that opens and install the latest available version (0.5.0 at time of writing)</li>
  <li>You will be taken to the <code class="language-plaintext highlighter-rouge">Installed</code> page</li>
  <li>Click <code class="language-plaintext highlighter-rouge">Enable</code> on the <code class="language-plaintext highlighter-rouge">LndHub</code> extension.</li>
  <li>An <code class="language-plaintext highlighter-rouge">LndHub</code> item will appear under the <code class="language-plaintext highlighter-rouge">Extensions</code> heading on the left of your browser window. Go ahead and click it.</li>
  <li>You will be presented with 2 QR codes. The one on the left is the “invoice URL” and the one on the right is the “admin URL”. We will use the “invoice URL” to set up your point of sale device.</li>
</ul>

<h4 id="turn-off-lnbits_admin_ui-again">Turn off LNBITS_ADMIN_UI again</h4>

<p>Once LNDHub is installed, you’ll want to turn off LNBITS_ADMIN_UI again in LNBits. Go back to your terminal and edit the LNBits .env file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nano ~/code/lnbits/.env
</code></pre></div></div>

<p>Change <code class="language-plaintext highlighter-rouge">LNBITS_ADMIN_UI=true</code> to <code class="language-plaintext highlighter-rouge">LNBITS_ADMIN_UI=false</code></p>

<p>Save and close (ctrl+s, ctrl+x)</p>

<p><strong>Now let’s connect your point of sale app! (Zeus if you are using LNBits with LNDHub)</strong></p>

<h2 id="albyhub">Albyhub</h2>

<p>Albyhub is a quick way to get started accepting Lightning payments. In this tutorial, we will use it with one of two backends:</p>

<ul>
  <li>LDK (bundled with Albyhub), or</li>
  <li>Phoenixd</li>
</ul>

<p>You can run albyhub in many places:</p>
<ul>
  <li>Desktop/laptop</li>
  <li>Docker (for orangepi or vps)</li>
  <li>Turnkey nodes like Start9 (doesn’t work with phoenixd for now)</li>
</ul>

<h3 id="desktop">Desktop</h3>
<ul>
  <li>Install the latest release from <a href="https://github.com/getAlby/hub/releases">here</a> (<a href="https://github.com/getAlby/hub/releases/tag/v1.14.2">v1.14.2</a> at time of writing)
    <ul>
      <li>Choose the compressed archive appropriate for your OS</li>
      <li>Extract the archive to a convenient directory</li>
    </ul>
  </li>
  <li>Run the “Alby Hub” binary
    <ul>
      <li>On Linux, this is <code class="language-plaintext highlighter-rouge">./albyhub-Desktop-Linux/albyhub-Desktop-Linux/bin/Alby\ Hub</code> from the dir you extracted the archive in</li>
    </ul>
  </li>
</ul>

<h3 id="docker-only-tested-on-linux">Docker (only tested on Linux)</h3>
<p>Docker makes setting up Albyhub easy!</p>

<h4 id="docker-compose-make-sure-to-stop-your-old-phoenixd-container-if-you-go-this-route">docker-compose (make sure to stop your old phoenixd container if you go this route)</h4>
<ul>
  <li>
    <p>Great for running Albyhub and Phoenixd together.</p>
  </li>
  <li>
    <p>Install docker-compose:</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
</code></pre></div>    </div>
  </li>
</ul>

<p>Create a directory for your albyhub data:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir -p albyhub &amp;&amp; cd albyhub
</code></pre></div></div>

<p>Create and populate <code class="language-plaintext highlighter-rouge">docker-compose.yml</code>:</p>
<ul>
  <li>Create:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nano docker-compose.yml
</code></pre></div>    </div>
  </li>
  <li>
    <p>Populate:
```
services:
albyhub:
  container_name: albyhub
  image: ghcr.io/getalby/hub:latest
  volumes:
    - ./albyhub-phoenixd:/data
  ports:
    - “8080:8080”
  links:
    - “albyhub-phoenixd:albyhub-phoenixd”
  environment:
    - WORK_DIR=/data/albyhub
    - LOG_EVENTS=true</p>

    <p>albyhub-phoenixd:
  platform: linux/arm64
  image: ghcr.io/sethforprivacy/phoenixd:latest
  container_name: albyhub-phoenixd
  ports:
    - “9740:9740”
  volumes:
    - phoenixd_data:/phoenix
  command: –agree-to-terms-of-service –http-bind-ip 0.0.0.0</p>
  </li>
</ul>

<p>volumes:
  phoenixd_data:
    external: true
```</p>

<h3 id="configure-albyhub-with-your-selected-backend-needed-for-both-desktop-and-docker">Configure Albyhub with your selected backend (needed for both Desktop and Docker)</h3>
<ul>
  <li>For LDK, just use the default
    <ul>
      <li>You will need to acquire inbound liquidity by buying an inbound channel from an LSP.</li>
    </ul>
  </li>
  <li>For Phoenixd, say “advanced” then “connect custom node” when you first go through the setup flow.
    <ul>
      <li>You cannot change this without deleting your Albyhub data, so make sure you do it the way you want the first time.</li>
      <li>Use <code class="language-plaintext highlighter-rouge">http://127.0.0.1:9740</code> (or LAN IP if running on a different computer) for Desktop, and <code class="language-plaintext highlighter-rouge">http://albyhub-phoenixd:9740</code> if running in docker-compose</li>
      <li>Grab your Phoenixd <code class="language-plaintext highlighter-rouge">http-password</code> as described in the <a href="#configure-lnbits">LNBits section above</a>, then paste that into the “Authorization” field in Albyhub Desktop.</li>
      <li>You should have already acquired inbound when you set up <a href="03-node">Phoenixd in the previous step</a>.</li>
    </ul>
  </li>
</ul>

<p><strong>Congrats, now you have your Lightning Hub set up!</strong></p>

<p>Read on to set up your workers’ point-of-sale app!</p>

  </article>

  <nav class="pagination">
    
    

    

    
    
    
      <a href="//tutorial/03-node/" class="btn btn-primary">&laquo; Previous: Phoenixd</a>
    
    
      <a href="//tutorial/05-pos-app/" class="btn btn-primary">Next: Point-of-sale App &raquo;</a>
    

  </nav>
</body>
</html>
